{% extends 'blog/base.html' %}
{% load static %}

{% block title %}{{ post.title }} - Reanstartup{% endblock %}

{% block meta %}
<meta name="description" content="{{ post.excerpt|truncatewords:30 }}">
<meta name="keywords" content="{{ post.tags }}">
<meta property="og:title" content="{{ post.title }}">
<meta property="og:description" content="{{ post.excerpt|truncatewords:30 }}">
<meta property="og:type" content="article">
<meta property="og:url" content="{{ request.build_absolute_uri }}">
{% if post.image_url %}
<meta property="og:image" content="{{ post.image_url }}">
{% endif %}
<meta property="article:published_time" content="{{ post.created_at|date:"c" }}">
<meta property="article:modified_time" content="{{ post.updated_at|date:"c" }}">
<meta property="article:author" content="{{ post.author }}">
{% for tag in post.tags.split %}
<meta property="article:tag" content="{{ tag }}">
{% endfor %}
{% endblock %}

{% block content %}
<div class="container pt-5 pb-5">
    <article class="blog-post">
        <header class="blog-post-header">
            <h1 class="blog-post-title">{{ post.title }}</h1>
            <div class="blog-post-meta">
                <span class="author">By {{ post.author }}</span>
                <span class="date">{{ post.created_at|date:"F d, Y" }}</span>
                <span class="category">{{ post.content_type }}</span>
            </div>
        </header>

        <div class="blog-post-content mt-4">
            {{ post.content|safe }}
        </div>

        <footer class="blog-post-footer mt-4 mb-5 pb-5">
            <div class="blog-post-stats">
                <span class="views"><i class="fas fa-eye"></i> {{ post.views_count }} views</span>
                <span class="likes"><i class="fas fa-heart"></i> {{ post.likes_count }} likes</span>
            </div>
            <div class="blog-post-tags mt-3">
                {% for tag in post.tags.split %}
                <span class="tag-badge">{{ tag }}</span>
                {% endfor %}
            </div>
            <div class="blog-post-updated mt-3">
                <small class="text-muted">Last updated: {{ post.updated_at|date:"F d, Y H:i" }}</small>
            </div>
        </footer>
    </article>
</div>
<div id="qrPopup" class="qr-popup justify-content-center">
    <div class="qr-popup-content">
        <button class="close-popup">&times;</button>
        <img src="{% static 'images/qr_code.png' %}" alt="QR Code" id="qrCode">
        <p>If you enjoyed this article, consider buying me a coffee</p>
        <button id="showBtn" class="btn btn-coffee" onclick="location.href='https://link.payway.com.kh/ABAPAYQG304240M'">Buy me a coffee</button>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var popup = document.getElementById('qrPopup');
    var closeBtn = document.getElementsByClassName('close-popup')[0];
    var popupShown = false;

    // Close popup when clicking the close button
    closeBtn.onclick = function() {
        popup.style.display = "none";
    }

    // Show popup when scrolled to bottom
    window.onscroll = function() {
        console.log('Scrolling', window.innerHeight + window.scrollY, document.body.offsetHeight);
        if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 100) {
            console.log('Near bottom');
            if (!popupShown) {
                console.log('Showing popup');
                popup.style.display = "flex";
                popupShown = true;
            }
        }
    };

    console.log('Script loaded');
});
</script>
{% endblock %}
